pbjsChunk([118],{454:function(e,t,r){e.exports=r(455)},455:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"spec",function(){return i}),t.injectAdIdsIntoAllBidResponses=a,t.checkDeepArray=s,t.defaultSize=D,t.ozoneGetWinnerForRequestBid=z,t.ozoneGetAllBidsForBidId=Z,t.getRoundedBid=P,t.getGranularityKeyName=l,t.getGranularityObject=g,t.ozoneAddStandardProperties=T,t.getWidthAndHeightFromVideoObject=O,t.playerSizeIsNestedArray=m;var b=r(0),o=r(1),h=r(2),y=r(3),c=r(43),E=r(10);function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n="ozone",f="https://elb.the-ozone-project.com/openrtb2/auction",d="https://elb.the-ozone-project.com/static/load-cookie.html",A="https://prebid.the-ozone-project.com/ozone-renderer.js",N="2.2.0",i={code:n,supportedMediaTypes:[h.d,h.b],cookieSyncBag:{publisherId:null,siteId:null,userIdObject:{}},placementIdWasOverridenByGetParam:{val:0},isBidRequestValid:function(e){if(b.logInfo("OZONE: isBidRequestValid : ",y.b.getConfig()),!e.params.hasOwnProperty("placementId"))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : missing placementId : siteId, placementId and publisherId are REQUIRED"),!1;if(!this.isValidPlacementId(e.params.placementId))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : placementId must be exactly 10 numeric characters"),!1;if(!e.params.hasOwnProperty("publisherId"))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : missing publisherId : siteId, placementId and publisherId are REQUIRED"),!1;if(!e.params.publisherId.toString().match(/^[a-zA-Z0-9\-]{12}$/))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : publisherId must be exactly 12 alphanumieric characters including hyphens"),!1;if(!e.params.hasOwnProperty("siteId"))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : missing siteId : siteId, placementId and publisherId are REQUIRED"),!1;if(!e.params.siteId.toString().match(/^[0-9]{10}$/))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : siteId must be exactly 10 numeric characters"),!1;if(e.params.hasOwnProperty("customParams"))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : customParams should be renamed to customData"),!1;if(e.params.hasOwnProperty("customData")){if(!Array.isArray(e.params.customData))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : customData is not an Array"),!1;if(e.params.customData.length<1)return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : customData is an array but does not contain any elements"),!1;if(!e.params.customData[0].hasOwnProperty("targeting"))return b.logInfo('OZONE: OZONE BID ADAPTER VALIDATION FAILED : customData[0] does not contain "targeting"'),!1;if("object"!=v(e.params.customData[0].targeting))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : customData[0] targeting is not an object"),!1}if(e.params.hasOwnProperty("lotameData")&&"object"!==v(e.params.lotameData))return b.logInfo("OZONE: OZONE BID ADAPTER VALIDATION FAILED : lotameData is not an object"),!1;if(e.hasOwnProperty("mediaTypes")&&e.mediaTypes.hasOwnProperty(h.d)){if(!e.mediaTypes.video.hasOwnProperty("context"))return b.logInfo("OZONE: [WARNING] No context key/value in bid. Rejecting bid: ",e),!1;if("outstream"!==e.mediaTypes.video.context)return b.logInfo("OZONE: [WARNING] Only outstream video is supported. Rejecting bid: ",e),!1}return!0},isValidPlacementId:function(e){return e.toString().match(/^[0-9]{10}$/)},buildRequests:function(e,r){var a=this;b.logInfo("OZONE: ozone v2.2.0 validBidRequests",e,"bidderRequest",r);var t={publisherId:"",siteId:""};0<e.length&&(this.cookieSyncBag.userIdObject=I(this.cookieSyncBag.userIdObject,this.findAllUserIds(e[0])),this.cookieSyncBag.siteId=b.deepAccess(e[0],"params.siteId"),this.cookieSyncBag.publisherId=b.deepAccess(e[0],"params.publisherId"),t=e[0].params),b.logInfo("OZONE: cookie sync bag",this.cookieSyncBag);var o=y.b.getConfig("ozone.singleRequest");o=!1!==o,b.logInfo("OZONE: config ozone.singleRequest : ",o);var n={};delete n.test,r&&r.gdprConsent?(b.logInfo("OZONE: ADDING GDPR info"),n.regs={},n.regs.ext={},n.regs.ext.gdpr=r.gdprConsent.gdprApplies?1:0,n.regs.ext.gdpr?(n.user=n.user||{},n.user.ext={consent:r.gdprConsent.consentString}):b.logInfo("OZONE: **** Failed to find required info for GDPR for request object, even though bidderRequest.gdprConsent is TRUE ****")):b.logInfo("OZONE: WILL NOT ADD GDPR info; no bidderRequest.gdprConsent object was present.");var i=this.getGetParametersAsObject(),s=i.hasOwnProperty("oztestmode")?i.oztestmode:null;n.device={w:window.innerWidth,h:window.innerHeight};var d=e.map(function(e){var t={},r=a.getPlacementId(e);t.id=e.bidId,t.tagid=r,t.secure="https:"===window.location.protocol?1:0;var o=[];if(e.hasOwnProperty("mediaTypes")){if(e.mediaTypes.hasOwnProperty(h.b)&&(o=e.mediaTypes[h.b].sizes,b.logInfo("OZONE: setting banner size from the mediaTypes.banner element for bidId "+t.id+": ",o)),e.mediaTypes.hasOwnProperty(h.d)){t.video=e.mediaTypes[h.d];var n=O(t.video);b.logInfo("OZONE: setting video object from the mediaTypes.video element: "+t.id+":",t.video,"wh=",n),n&&"object"===v(n)?(t.video.w=n.w,t.video.h=n.h,m(t.video)?(b.logInfo("OZONE: setting obj.video.format to be an array of objects"),t.video.format=[n]):(b.logInfo("OZONE: setting obj.video.format to be an object"),t.video.format=n)):b.logInfo("OZONE: cannot set w, h & format values for video; the config is not right")}e.mediaTypes.hasOwnProperty(h.c)&&(t.native=e.mediaTypes[h.c],b.logInfo("OZONE: setting native object from the mediaTypes.native element: "+t.id+":",t.native))}else e.hasOwnProperty("sizes")?(b.logInfo("OZONE: no mediaTypes detected - will use the sizes array in the config root"),o=e.sizes):b.logInfo("OZONE: no mediaTypes detected, no sizes array in the config root either. Cannot set sizes for banner type");if(0<o.length&&(t.banner={topframe:1,w:o[0][0]||0,h:o[0][1]||0,format:o.map(function(e){return{w:e[0],h:e[1]}})}),t.placementId=r,t.ext={prebid:{storedrequest:{id:r}},ozone:{}},t.ext.ozone.adUnitCode=e.adUnitCode,t.ext.ozone.transactionId=e.transactionId,e.params.hasOwnProperty("customData")&&(t.ext.ozone.customData=e.params.customData),b.logInfo("obj.ext.ozone is ",t.ext.ozone),null!=s)if(b.logInfo("setting ozTestMode to ",s),t.ext.ozone.hasOwnProperty("customData"))for(var i=0;i<t.ext.ozone.customData.length;i++)t.ext.ozone.customData[i].targeting.oztestmode=s;else t.ext.ozone.customData=[{settings:{},targeting:{oztestmode:s}}];else b.logInfo("no ozTestMode ");return b.logInfo("lotameData",e,e.params.lotameData),e.params.hasOwnProperty("lotameData")?t.ext.ozone.lotameData=e.params.lotameData:t.ext.ozone.lotameData="Failed to find lotameData",t}),u={ozone:{oz_pb_v:N,oz_rw:this.placementIdWasOverridenByGetParam.val}};if(0<e.length){var c=this.findAllUserIds(e[0]);c.hasOwnProperty("pubcid")&&(u.ozone.pubcid=c.pubcid)}var l=this.generateEids(e);if(n.site={publisher:{id:t.publisherId},page:document.location.href,id:t.siteId},n.test=i.hasOwnProperty("pbjs_debug")&&"true"==i.pbjs_debug?1:0,o){b.logInfo("OZONE: buildRequests starting to generate response for a single request"),n.id=r.auctionId,n.auctionId=r.auctionId,n.imp=d,n.ext=u,n.source={tid:r.auctionId},b.deepSetValue(n,"user.ext.eids",l);var g={method:"POST",url:f,data:JSON.stringify(n),bidderRequest:r};return b.logInfo("OZONE: buildRequests ozoneRequest for single = ",n),b.logInfo("OZONE: buildRequests going to return for single: ",g),g}var p=d.map(function(e){b.logInfo("OZONE: buildRequests starting to generate non-single response, working on imp : ",e);var t=I({},n);return e.ext.ozone.pageAuctionId=r.auctionId,t.id=e.ext.ozone.transactionId,t.auctionId=e.ext.ozone.transactionId,t.imp=[e],t.ext=u,t.source={tid:e.ext.ozone.transactionId},b.deepSetValue(t,"user.ext.eids",l),b.logInfo("OZONE: buildRequests ozoneRequestSingle (for non-single) = ",t),{method:"POST",url:f,data:JSON.stringify(t),bidderRequest:r}});return b.logInfo("OZONE: buildRequests going to return for non-single: ",p),p},interpretResponse:function(p,I){if(b.logInfo("OZONE: interpretResponse: serverResponse, request",p,I),!(p=p.body||{}).hasOwnProperty("seatbid"))return[];if("object"!==v(p.seatbid))return[];var f=[],O=y.b.getConfig("ozone.enhancedAdserverTargeting");b.logInfo("OZONE: enhancedAdserverTargeting",O),void 0===O&&(O=!0),b.logInfo("OZONE: enhancedAdserverTargeting",O),p.seatbid=a(p.seatbid);for(var e=0;e<p.seatbid.length;e++)for(var m=p.seatbid[e],t=function(e){var t,r=D(I.bidderRequest.bids[e]),o=r.defaultWidth,n=r.defaultHeight,i=T(m.bid[e],o,n);if(b.deepAccess(i,"ext.prebid.type")===h.d){b.logInfo("OZONE: going to attach a renderer to:",e);var a={url:A,callback:function(){return function(e){try{e.renderer.setRender(w)}catch(e){b.logWarn("Prebid Error calling setRender on renderer",e)}}(t)}};(t=i).renderer=E.a.install(a)}else b.logInfo("OZONE: bid is not a video, will not attach a renderer: ",e);var s=i.bidId,d={};if(O){var u=Z(s,p.seatbid);b.logInfo("OZONE: Going to iterate allBidsForThisBidId",u),Object.keys(u).forEach(function(e,t,r){d["oz_"+e]=e,d["oz_"+e+"_pb"]=String(u[e].price),d["oz_"+e+"_crid"]=String(u[e].crid),d["oz_"+e+"_adv"]=String(u[e].adomain),d["oz_"+e+"_imp_id"]=String(u[e].impid),d["oz_"+e+"_adId"]=String(u[e].adId),d["oz_"+e+"_pb_r"]=P(u[e].price,u[e].ext.prebid.type),u[e].hasOwnProperty("dealid")&&(d["oz_"+e+"_dealid"]=String(u[e].dealid))})}var c=z(s,p.seatbid),l=c.seat,g=c.bid;d.oz_auc_id=String(I.bidderRequest.auctionId),d.oz_winner=String(l),d.oz_response_id=String(p.id),O&&(d.oz_winner_auc_id=String(g.id),d.oz_winner_imp_id=String(g.impid),d.oz_pb_v=N),i.adserverTargeting=d,f.push(i)},r=0;r<m.bid.length;r++)t(r);return b.logInfo("OZONE: interpretResponse going to return",f),f},getUserSyncs:function(e,t,r){if(b.logInfo("OZONE: getUserSyncs optionsType, serverResponse, gdprConsent, cookieSyncBag",e,t,r,this.cookieSyncBag),!t||0===t.length)return[];if(e.iframeEnabled){var o=[];document.location.search.match(/pbjs_debug=true/)&&o.push("pbjs_debug=true"),o.push("gdpr="+(b.deepAccess(r,"gdprApplies",!1)?"1":"0")),o.push("gdpr_consent="+b.deepAccess(r,"consentString",""));var n=Object.getOwnPropertyNames(this.cookieSyncBag.userIdObject);for(var i in n){var a=n[i];o.push(a+"="+this.cookieSyncBag.userIdObject[a])}o.push("publisherId="+this.cookieSyncBag.publisherId),o.push("siteId="+this.cookieSyncBag.siteId),o.push("cb="+Date.now());var s=o.join("&");return 0<s.length&&(s="?"+s),b.logInfo("OZONE: getUserSyncs going to return cookie sync url : "+d+s),[{type:"iframe",url:d+s}]}},findAllUserIds:function(e){var t={},r=["pubcid","tdid","id5id","parrableid","idl_env","digitrustid","criteortus"];if(b.logInfo("OZONE: debug iterating keys"),b.logInfo("OZONE: debug bidRequest=",e),e.hasOwnProperty("userId")){for(var o in b.logInfo("OZONE: debug Looking inside userId element"),r){var n=r[o];b.logInfo("OZONE: debug key=",n),e.userId.hasOwnProperty(n)&&(b.logInfo("OZONE: debug found value : ",n),t[n]=e.userId[n])}var i=b.deepAccess(e.userId,"lipb.lipbid");i&&(t.lipb={lipbid:i})}if(!t.hasOwnProperty("pubcid")){var a=b.deepAccess(e,"crumbs.pubcid");a&&(t.pubcid=a)}return b.logInfo("OZONE: debug going to return: ",t),t},getPlacementId:function(e){var t=this.getGetParametersAsObject();if(this.placementIdWasOverridenByGetParam.val=0,t.hasOwnProperty("ozstoredrequest")){if(this.isValidPlacementId(t.ozstoredrequest)){var r=t.ozstoredrequest;return b.logInfo("OZONE: using GET ozstoredrequest "+r+" to replace placementId"),this.placementIdWasOverridenByGetParam.val=1,r}b.logError("OZONE: GET ozstoredrequest FAILED VALIDATION - will not use it")}return e.params.placementId.toString()},addExternalUserId:function(e,t,r,o){b.isStr(t)&&e.push({source:r,uids:[{id:t,atype:o}]})},generateEids:function(e){var t=[];this.handleTTDId(t,e);var r=e[0];return r&&r.userId&&(this.addExternalUserId(t,b.deepAccess(r,"userId.pubcid"),"pubcid",1),this.addExternalUserId(t,b.deepAccess(r,"userId.pubcid"),"pubcommon",1),this.addExternalUserId(t,b.deepAccess(r,"userId.id5id"),"id5-sync.com",1),this.addExternalUserId(t,b.deepAccess(r,"userId.criteortus.".concat(n,".userid")),"criteortus",1),this.addExternalUserId(t,b.deepAccess(r,"userId.idl_env"),"liveramp.com",1),this.addExternalUserId(t,b.deepAccess(r,"userId.lipb.lipbid"),"liveintent.com",1),this.addExternalUserId(t,b.deepAccess(r,"userId.parrableid"),"parrable.com",1)),t},handleTTDId:function(e,t){var r=null,o=y.b.getConfig("adsrvrOrgId");b.isStr(b.deepAccess(t,"0.userId.tdid"))?r=t[0].userId.tdid:o&&b.isStr(o.TDID)&&(r=o.TDID),null!==r&&e.push({source:"adserver.org",uids:[{id:r,atype:1,ext:{rtiPartner:"TDID"}}]})},getGetParametersAsObject:function(){for(var e=location.search.substr(1).split("&"),t={},r=null,o=0;o<e.length;o++)t[(r=e[o].split("="))[0]]=r[1];return t}};function a(e){for(var t=0;t<e.length;t++)for(var r=e[t],o=0;o<r.bid.length;o++)r.bid[o].adId=r.bid[o].impid+"-"+t;return e}function s(e){return Array.isArray(e)&&Array.isArray(e[0])?e[0]:e}function D(e){if(!e)return b.logInfo("OZONE: defaultSize received empty bid obj! going to return fixed default size"),{defaultHeight:250,defaultWidth:300};var t=e.sizes,r={};return r.defaultWidth=s(t)[0],r.defaultHeight=s(t)[1],r}function z(e,t){for(var r=null,o=null,n=0;n<t.length;n++)for(var i=t[n].bid,a=t[n].seat,s=0;s<i.length;s++)if(i[s].impid===e&&(null==r||r.price<i[s].price)){r=i[s],o=a;break}return{seat:o,bid:r}}function Z(e,t){for(var r={},o=0;o<t.length;o++)for(var n=t[o].bid,i=t[o].seat,a=0;a<n.length;a++)n[a].impid===e&&(r[i]=n[a]);return r}function P(e,t){var r=y.b.getConfig("mediaTypePriceGranularity.".concat(t)),o=y.b.getConfig("customPriceBucket"),n=y.b.getConfig("priceGranularity"),i=g(0,r,n,o),a=l(0,r,n);b.logInfo("OZONE: getRoundedBid. price:",e,"mediaType:",t,"configkey:",a,"configObject:",i,"mediaTypeGranularity:",r,"strBuckets:",n);var s=Object(c.a)(e,i,y.b.getConfig("currency.granularityMultiplier"));b.logInfo("OZONE: priceStringsObj",s);var d={medium:"med",custom:"custom",high:"high",low:"low",dense:"dense"};if(d.hasOwnProperty(a)){var u=d[a];return b.logInfo("OZONE: looking for priceStringsKey:",u),s[u]}return s.auto}function l(e,t,r){return"string"==typeof t?t:"object"===v(t)?"custom":"string"==typeof r?r:"auto"}function g(e,t,r,o){return"object"===v(t)?t:"custom"===r?o:""}function T(e,t,r){return e.cpm=e.price,e.bidId=e.impid,e.requestId=e.impid,e.width=e.w||t,e.height=e.h||r,e.ad=e.adm,e.netRevenue=!0,e.creativeId=e.crid,e.currency="USD",e.ttl=300,e}function w(e){window.ozoneVideo.outstreamRender(e)}function O(e){var t=u(e);return t?t[0]&&"object"===v(t[0])&&(b.logInfo("OZONE: getWidthAndHeightFromVideoObject found nested array inside playerSize.",t[0]),"number"!=typeof(t=t[0])[0]&&"string"!=typeof t[0])?(b.logInfo("OZONE: getWidthAndHeightFromVideoObject found non-number/string type inside the INNER array in playerSize. This is totally wrong - cannot continue.",t[0]),null):2!==t.length?(b.logInfo("OZONE: getWidthAndHeightFromVideoObject found playerSize with length of "+t.length+". This is totally wrong - cannot continue."),null):{w:t[0],h:t[1]}:null}function m(e){var t=u(e);return!t||t.length<1?null:t[0]&&"object"===v(t[0])}function u(e){if(b.logInfo("OZONE: getPlayerSizeFromObject received object",e),!e.hasOwnProperty("playerSize"))return b.logError("OZONE: getPlayerSizeFromObject FAILED: no playerSize in video object",e),null;var t=e.playerSize;return"object"!==v(t)?(b.logError("OZONE: getPlayerSizeFromObject FAILED: playerSize is not an object/array",e),null):t}Object(o.registerBidder)(i),b.logInfo("OZONE: ozoneBidAdapter ended")}},[454]);