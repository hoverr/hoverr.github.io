pbjsChunk([54],{617:function(e,t,n){e.exports=n(618)},618:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"syncDelay",function(){return u}),n.d(t,"auctionDelay",function(){return s}),t.setSubmoduleRegistry=function(e){_=e},t.requestBidsHook=U,t.attachIdSystem=P,t.init=R;var c,u,s,o=n(12),a=n.n(o),r=n(3),i=n(8),l=n.n(i),f=n(0),d=n(20),g=n(7),m=n(5),b=n.n(m),p=n(13),y="User ID",v="cookie",I="html5",S=500,h=0,O=[],j=!1,k=[],D=[],_=[];function E(e,t){try{var n=f.isPlainObject(t)?JSON.stringify(t):t,o=new Date(Date.now()+864e5*e.expires).toUTCString();e.type===v?(f.setCookie(e.name,n,o,"Lax"),"number"==typeof e.refreshInSeconds&&f.setCookie("".concat(e.name,"_last"),(new Date).toUTCString(),o)):e.type===I&&(localStorage.setItem("".concat(e.name,"_exp"),o),localStorage.setItem(e.name,encodeURIComponent(n)),"number"==typeof e.refreshInSeconds&&localStorage.setItem("".concat(e.name,"_last"),(new Date).toUTCString()))}catch(e){f.logError(e)}}function C(e,t){var n,o=1<arguments.length&&void 0!==t?t:void 0,a=o?"".concat(e.name,"_").concat(o):e.name;try{if(e.type===v)n=f.getCookie(a);else if(e.type===I){var r=localStorage.getItem("".concat(e.name,"_exp"));""===r?n=localStorage.getItem(a):r&&0<new Date(r).getTime()-Date.now()&&(n=decodeURIComponent(localStorage.getItem(a)))}"string"==typeof n&&"{"===n.charAt(0)&&(n=JSON.parse(n))}catch(e){f.logError(e)}return n}function A(e,t){var n=t?f.delayExecution(t,e.length):function(){};e.forEach(function(t){t.callback(function(e){e?(t.config.storage&&E(t.config.storage,e),t.idObj=t.submodule.decode(e)):f.logError("".concat(y,": ").concat(t.submodule.name," - request id responded with an empty value")),n()}),t.callback=void 0})}function x(e){return Array.isArray(e)&&e.length?e.filter(function(e){return f.isPlainObject(e.idObj)&&Object.keys(e.idObj).length}).reduce(function(t,n){return Object.keys(n.idObj).forEach(function(e){t[e]=n.idObj[e]}),t},{}):{}}function T(e){var t,i,n=!1;if(void 0===c&&(t=k,i=g.gdprDataHandler.getConsentData(),(c=function(e){if(e&&"boolean"==typeof e.gdprApplies&&e.gdprApplies){if(!e.consentString)return;if(e.vendorData&&e.vendorData.purposeConsents&&!1===e.vendorData.purposeConsents[1])return}return 1}(i)?t.reduce(function(e,t){if(t.config.storage){var n,o=C(t.config.storage),a=!1;if("number"==typeof t.config.storage.refreshInSeconds){var r=new Date(C(t.config.storage,"last"));a=r&&Date.now()-r.getTime()>1e3*t.config.storage.refreshInSeconds}!0===b.a.SUBMODULES_THAT_ALWAYS_REFRESH_ID[t.config.name]&&(a=!0),!o||a?n=t.submodule.getId(t.config.params,i,o):"function"==typeof t.submodule.extendId&&(n=t.submodule.extendId(t.config.params,o)),f.isPlainObject(n)&&(n.id&&(E(t.config.storage,n.id),o=n.id),"function"==typeof n.callback&&(t.callback=n.callback)),o&&(t.idObj=t.submodule.decode(o))}else if(t.config.value)t.idObj=t.config.value;else{var c=t.submodule.getId(t.config.params,i,void 0);f.isPlainObject(c)&&("function"==typeof c.callback&&(t.callback=c.callback),c.id&&(t.idObj=t.submodule.decode(c.id)))}return e.push(t),e},[]):(f.logWarn("".concat(y," - gdpr permission not valid for local storage or cookies, exit module")),[])).length)){var o=c.filter(function(e){return f.isFn(e.callback)});if(o.length)if(e&&0<s){var a=!(n=!0),r=function(){a||(a=!0,e())};f.logInfo("".concat(y," - auction delayed by ").concat(s," at most to fetch ids")),A(o,r),setTimeout(r,s)}else l.a.on(b.a.EVENTS.AUCTION_END,function e(){l.a.off(b.a.EVENTS.AUCTION_END,e),0<u?setTimeout(function(){A(o)},u):A(o)})}e&&!n&&e()}function U(e,t){T(function(){!function(e,t){if(![e].some(function(e){return!Array.isArray(e)||!e.length})){var n=x(t);Object.keys(n).length&&e.forEach(function(e){e.bids.forEach(function(e){e.userId=n})})}}(t.adUnits||Object(d.a)().adUnits,c),e.call(this,t)})}function N(){return T(),x(c)}function w(){var e,n,o=(e=D,n=O,Array.isArray(e)?e.reduce(function(e,t){return!t||f.isEmptyStr(t.name)||(!t.storage||f.isEmptyStr(t.storage.type)||f.isEmptyStr(t.storage.name)||-1===n.indexOf(t.storage.type))&&!f.isPlainObject(t.value)&&(t.storage||t.value)||e.push(t),e},[]):[]);if(o.length){var t=_.filter(function(t){return!a()(k,function(e){return e.name===t.name})});k=t.map(function(t){var e=a()(o,function(e){return e.name===t.name});return e?{submodule:t,config:e,callback:void 0,idObj:void 0}:null}).filter(function(e){return null!==e}),!j&&k.length&&(Object(d.a)().requestBids.before(U,40),f.logInfo("".concat(y," - usersync config updated for ").concat(k.length," submodules")),j=!0)}}function P(t){a()(_,function(e){return e.name===t.name})||(_.push(t),w())}function R(e){k=[],j=!(D=[]),c=void 0,-1===(O=[f.localStorageIsEnabled()?I:null,f.cookiesAreEnabled()?v:null].filter(function(e){return null!==e})).indexOf(v)||!f.getCookie("_pbjs_id_optout")&&!f.getCookie("_pubcid_optout")?-1===O.indexOf(I)||!localStorage.getItem("_pbjs_id_optout")&&!localStorage.getItem("_pubcid_optout")?(e.getConfig(function(e){var t=e.userSync||e.usersync;t&&t.userIds&&(D=t.userIds,u=f.isNumber(t.syncDelay)?t.syncDelay:S,s=f.isNumber(t.auctionDelay)?t.auctionDelay:h,w())}),Object(d.a)().getUserIds=N):f.logInfo("".concat(y," - opt-out localStorage found, exit module")):f.logInfo("".concat(y," - opt-out cookie found, exit module"))}R(r.b),Object(p.c)("userId",P)}},[617]);