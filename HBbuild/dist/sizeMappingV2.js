atdpbjsChunk([91],{564:function(e,i,n){e.exports=n(565)},565:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),n.d(i,"internal",function(){return z}),n.d(i,"sizeMappingInternalStore",function(){return l}),i.isUsingNewSizeMapping=o,i.checkAdUnitSetupHook=c,i.checkBidderSizeConfigFormat=p,i.isLabelActivated=f,i.getFilteredMediaTypes=m,i.isSizeConfigActivated=b,i.getActiveSizeBucket=h,i.getRelevantMediaTypesForBidder=A,i.getAdUnitDetail=T,i.getBids=S;var u=n(0),g=n(23),y=n(53),t=n(11),d=n.n(t),r=n(13),s=n(55);function v(){return(v=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}var a,z={checkBidderSizeConfigFormat:p,getActiveSizeBucket:h,getFilteredMediaTypes:m,getAdUnitDetail:T,getRelevantMediaTypesForBidder:A,isLabelActivated:f},l=(a={},{initializeStore:function(e,i){a[e]={usingSizeMappingV2:i,adUnits:[]}},getAuctionDetail:function(e){return a[e]},setAuctionDetail:function(e,i){a[e].adUnits.push(i)}});function o(e){var n=!1;return e.forEach(function(i){i.mediaTypes&&(Object.keys(i.mediaTypes).forEach(function(e){i.mediaTypes[e].sizeConfig&&!1===n&&(n=!0)}),i.bids.forEach(function(e){e.sizeConfig&&!1===n&&(n=!0)}))}),n}function c(e){return e.filter(function(a){var e=a.mediaTypes;if(!e||0===Object.keys(e).length)return u.logError("Detected adUnit.code '".concat(a.code,"' did not have a 'mediaTypes' object defined. This is a required field for the auction, so this adUnit has been removed.")),!1;if(e.banner){var i=e.banner;if(i.sizes)s.adUnitSetupChecks.validateBannerMediaType(a);else if(i.sizeConfig)if(Array.isArray(i.sizeConfig)){var r=!1;i.sizeConfig.forEach(function(e,i){var n=Object.keys(e);if(!d()(n,"minViewPort")||!d()(n,"sizes"))return u.logError("Ad Unit: ".concat(a.code,": mediaTypes.banner.sizeConfig[").concat(i,"] is missing required property minViewPort or sizes or both.")),void(r=!0);var t=s.adUnitSetupChecks.validateSizes(e.sizes);u.isArrayOfNums(e.minViewPort,2)?0<e.sizes.length&&0<t.length?e.sizes=t:0===e.sizes.length?e.sizes=[e.sizes]:(u.logError("Ad Unit: ".concat(a.code,": mediaTypes.banner.sizeConfig[").concat(i,"] has propery sizes declared with invalid value. Please ensure the sizes are listed like: [[300, 250], ...] or like: [] if no sizes are present for that size bucket.")),r=!0):(u.logError("Ad Unit: ".concat(a.code,": mediaTypes.banner.sizeConfig[").concat(i,"] has property minViewPort decalared with invalid value. Please ensure minViewPort is an Array and is listed like: [700, 0]. Declaring an empty array is not allowed, instead use: [0, 0].")),r=!0)}),r&&(u.logInfo("Ad Unit: ".concat(a.code,": mediaTypes.banner has been removed due to error in sizeConfig.")),delete a.mediaTypes.banner)}else u.logError("Ad Unit: ".concat(a.code,": mediaTypes.banner.sizeConfig is NOT an Array. Removing the invalid object mediaTypes.banner from Ad Unit.")),delete a.mediaTypes.banner;else u.logError("Detected a mediaTypes.banner object did not include required property sizes or sizeConfig. Removing invalid mediaTypes.banner object from Ad Unit."),delete a.mediaTypes.banner}if(e.video){var n=e.video;if(n.playerSize)s.adUnitSetupChecks.validateVideoMediaType(a);else if(n.sizeConfig){if(!Array.isArray(n.sizeConfig))return u.logError("Ad Unit: ".concat(a.code,": mediaTypes.video.sizeConfig is NOT an Array. Removing the invalid property mediaTypes.video.sizeConfig from Ad Unit.")),delete a.mediaTypes.video.sizeConfig;var o=!1;n.sizeConfig.forEach(function(e,i){var n=Object.keys(e);if(!d()(n,"minViewPort")||!d()(n,"playerSize"))return u.logError("Ad Unit: ".concat(a.code,": mediaTypes.video.sizeConfig[").concat(i,"] is missing required property minViewPort or playerSize or both. Removing the invalid property mediaTypes.video.sizeConfig from Ad Unit.")),void(o=!0);var t="number"==typeof e.playerSize[0]?2:1,r=s.adUnitSetupChecks.validateSizes(e.playerSize,t);u.isArrayOfNums(e.minViewPort,2)?(2==t&&u.logInfo("Transforming video.playerSize from [640,480] to [[640,480]] so it's in the proper format."),0<e.playerSize.length&&0<r.length?e.playerSize=r:0===e.playerSize.length?e.playerSize=[e.playerSize]:(u.logError("Ad Unit: ".concat(a.code,": mediaTypes.video.sizeConfig[").concat(i,"] has propery playerSize declared with invalid value. Please ensure the playerSize is listed like: [640, 480] or like: [] if no playerSize is present for that size bucket.")),o=!0)):(u.logError("Ad Unit: ".concat(a.code,": mediaTypes.video.sizeConfig[").concat(i,"] has property minViewPort decalared with invalid value. Please ensure minViewPort is an Array and is listed like: [700, 0]. Declaring an empty array is not allowed, instead use: [0, 0].")),o=!0)}),o&&(u.logInfo("Ad Unit: ".concat(a.code,": mediaTypes.video.sizeConfig has been removed due to error in sizeConfig.")),delete a.mediaTypes.video.sizeConfig)}}if(e.native){var t=e.native;s.adUnitSetupChecks.validateNativeMediaType(a),e.native.sizeConfig&&t.sizeConfig.forEach(function(e){var i=Object.keys(e);return d()(i,"minViewPort")&&d()(i,"active")?u.isArrayOfNums(e.minViewPort,2)&&"boolean"==typeof e.active?void 0:(u.logError("Ad Unit: ".concat(a.code,": mediaTypes.native.sizeConfig has properties minViewPort or active decalared with invalid values. Removing the invalid property mediaTypes.native.sizeConfig from Ad Unit.")),delete a.mediaTypes.native.sizeConfig):(u.logError("Ad Unit: ".concat(a.code,": mediaTypes.native.sizeConfig is missing required property minViewPort or active or both. Removing the invalid property mediaTypes.native.sizeConfig from Ad Unit.")),delete a.mediaTypes.native.sizeConfig)})}return!0})}function p(e){var n=!0;return Array.isArray(e)&&0<e.length?e.forEach(function(e){var i=Object.keys(e);n=!!(d()(i,"minViewPort")&&d()(i,"relevantMediaTypes")&&u.isArrayOfNums(e.minViewPort,2)&&Array.isArray(e.relevantMediaTypes)&&0<e.relevantMediaTypes.length&&(1<e.relevantMediaTypes.length?e.relevantMediaTypes.every(function(e){return d()(["banner","video","native"],e)}):["none","banner","video","native"].indexOf(-1<e.relevantMediaTypes[0])))&&(n&&!0)}):n=!1,n}function f(e,i,n){var t,r=Object.keys(e).filter(function(e){return"labelAny"===e||"labelAll"===e});return r&&1<r.length&&u.logWarn("SizeMappingV2:: ".concat(e.code?"Ad Unit: ".concat(e.code," has multiple label operators. Using the first declared operator: ").concat(r[0]):"Bidder: ".concat(e.bidder," in Ad Unit: ").concat(n," has multiple label operators. Using the first declared operator: ").concat(r[0]))),"labelAll"===(t=r[0])&&Array.isArray(e[t])?0===e.labelAll.length?(u.logWarn("SizeMappingV2:: Ad Unit: ".concat(e.code," has declared property labelAll with an empty array. Ad Unit is still enabled!")),!0):e.labelAll.every(function(e){return d()(i,e)}):"labelAny"!==t||!Array.isArray(e[t])||(0===e.labelAny.length?(u.logWarn("SizeMappingV2:: Ad Unit: ".concat(e.code," has declared property labelAny with an empty array. Ad Unit is still enabled!")),!0):e.labelAny.some(function(e){return d()(i,e)}))}function m(r){var i,n,a;a=u.deepClone(r);var o={banner:void 0,video:void 0,native:void 0};try{i=u.getWindowTop().innerWidth,n=u.getWindowTop().innerHeight}catch(e){u.logWarn("SizeMappingv2:: Unfriendly iframe blocks viewport size to be evaluated correctly"),i=window.innerWidth,n=window.innerHeight}var d=[i,n];Object.keys(r).map(function(i){var e=r[i].sizeConfig;if(e){o[i]=h(e,d);var n=e.filter(function(e){return e.minViewPort===o[i]&&b(i,e)});a[i]=v({filteredSizeConfig:n},r[i]);var t={banner:"sizes",video:"playerSize"};0<a[i].filteredSizeConfig.length?"native"!==i&&(a[i][t[i]]=a[i].filteredSizeConfig[0][t[i]]):delete a[i]}});var e=Object.keys(o).filter(function(e){return void 0!==o[e]}).reduce(function(e,i){return e[i]={activeSizeBucket:o[i],activeSizeDimensions:"banner"===i?a.banner?a.banner.sizes:[]:"video"===i?a.video?a.video.playerSize:[]:"NA"},e},{});return{mediaTypes:r,sizeBucketToSizeMap:e,activeViewport:d,transformedMediaTypes:a}}function b(e,i){switch(e){case"banner":return i.sizes&&0<i.sizes.length&&0<i.sizes[0].length;case"video":return i.playerSize&&0<i.playerSize.length&&0<i.playerSize[0].length;case"native":return i.active;default:return!1}}function h(e,i){var n=[];return e.sort(function(e,i){return e.minViewPort[0]-i.minViewPort[0]}).forEach(function(e){i[0]>=e.minViewPort[0]&&(n=i[1]>=e.minViewPort[1]?e.minViewPort:[])}),n}function A(e,i){if(z.checkBidderSizeConfigFormat(e)){var n=z.getActiveSizeBucket(e,i);return e.filter(function(e){return e.minViewPort===n})[0].relevantMediaTypes}return[]}function T(e,i){var n=l.getAuctionDetail(e).adUnits.filter(function(e){return e.adUnitCode===i.code});if(0<n.length)return n[0];var t=z.getFilteredMediaTypes(i.mediaTypes),r=t.mediaTypes,a=t.sizeBucketToSizeMap,o=t.activeViewport,d=t.transformedMediaTypes,s={adUnitCode:i.code,mediaTypes:r,sizeBucketToSizeMap:a,activeViewport:o,transformedMediaTypes:d},c=Object.keys(r).filter(function(e){return-1===Object.keys(d).indexOf(e)});return u.logInfo("SizeMappingV2:: AdUnit: ".concat(i.code," - Active size buckets after filtration: "),a),0<c.length&&u.logInfo("SizeMappingV2:: AdUnit: ".concat(i.code," - mediaTypes that got filtered out: ").concat(c)),l.setAuctionDetail(e,s),s}function S(e){var s=e.bidderCode,c=e.auctionId,l=e.bidderRequestId,i=e.adUnits,p=e.labels,f=e.src;return i.reduce(function(e,a){if(!z.isLabelActivated(a,p,a.code))return u.logInfo("SizeMappingV2:: Ad Unit: ".concat(a.code," is disabled due to failing label check.")),e;if(a.mediaTypes&&u.isValidMediaTypes(a.mediaTypes)){var i=z.getAdUnitDetail(c,a),o=i.activeViewport,d=i.transformedMediaTypes;if(0===Object.keys(d).length)return u.logInfo("SizeMappingV2:: Ad Unit: ".concat(a.code," is disabled since there are no active media types after sizeConfig filtration.")),e;e.push(a.bids.filter(function(e){return e.bidder===s}).reduce(function(e,i){if(z.isLabelActivated(i,p,a.code)){var n=a.nativeParams||u.deepAccess(a,"mediaTypes.native");if(n&&(i=v({},i,{nativeParams:Object(g.g)(n)})),(i=v({},i,u.getDefinedParams(a,["mediaType","renderer"]))).sizeConfig){var t=z.getRelevantMediaTypesForBidder(i.sizeConfig,o);if(0===t.length)u.logError("SizeMappingV2:: AdUnit: ".concat(a.code,", Bidder: ").concat(s," - sizeConfig is not configured properly. This bidder won't be eligible for sizeConfig checks and will remail active.")),i=v({},i);else{if("none"===t[0])return u.logInfo("SizeMappingV2:: AdUnit: ".concat(a.code,", Bidder: ").concat(i.bidder," - 'relevantMediaTypes' is set to 'none' in sizeConfig for current viewport size. This bidder is disabled.")),e;var r=Object.keys(d).filter(function(e){return-1<t.indexOf(e)}).reduce(function(e,i){return e[i]=d[i],e},{});if(!(0<Object.keys(r).length))return u.logInfo("SizeMappingV2:: AdUnit: ".concat(a.code,", Bidder: ").concat(i.bidder," - 'relevantMediaTypes' for this bidder does not match with any of the active mediaTypes at the Ad Unit level. This bidder is disabled.")),e;i=v({},i,{mediaTypes:r})}}return e.push(v({},i,{adUnitCode:a.code,transactionId:a.transactionId,sizes:u.deepAccess(d,"banner.sizes")||u.deepAccess(d,"video.playerSize")||[],mediaTypes:i.mediaTypes||d,bidId:i.bid_id||u.getUniqueIdentifierStr(),bidderRequestId:l,auctionId:c,src:f,bidRequestsCount:y.a.getRequestsCounter(a.code),bidderRequestsCount:y.a.getBidderRequestsCounter(a.code,i.bidder),bidderWinsCount:y.a.getBidderWinsCounter(a.code,i.bidder)})),e}return u.logInfo("SizeMappingV2:: AdUnit: ".concat(a.code,", Bidder: ").concat(i.bidder," - Label check for this bidder has failed. This bidder is disabled.")),e},[]))}else u.logWarn("SizeMappingV2:: Ad Unit: ".concat(a.code," has declared invalid mediaTypes or has not declared a mediaTypes property"));return e},[]).reduce(u.flatten,[]).filter(function(e){return""!==e})}Object(r.a)("checkAdUnitSetup").before(function(e,i){return o(i)?(i=c(i),e.bail(i)):e.call(this,i)}),Object(r.a)("getBids").before(function(e,i){if(void 0===l.getAuctionDetail(i.auctionId)){var n=o(i.adUnits);l.initializeStore(i.auctionId,n)}if(l.getAuctionDetail(i.auctionId).usingSizeMappingV2){var t=S(i);return e.bail(t)}return e.call(this,i)})}},[564]);